{"version":3,"sources":["../../service/bd.js"],"names":["promise","require","options","promiseLib","pgp","connectionString","db","getSubjectsAndLectures","any","then","data","subjects","makeTreeViewSubjectsAndLectures","console","log","JSON","stringify","catch","err","error","currentSubjectId","length","subject_id","subject","getEmptySubject","i","lecture","subject_name","lecture_id","lecture_name","lectures","push"],"mappings":"AAAA;;AAEA,IAAMA,UAAUC,QAAQ,UAAR,CAAhB;;AAEA,IAAMC,UAAU;AACd;AACAC,cAAYH;AAFE,CAAhB;;AAKA,IAAII,MAAMH,QAAQ,YAAR,EAAsBC,OAAtB,CAAV;AACA,IAAIG,mBAAmB,mCAAvB;AACA,IAAIC,KAAKF,IAAIC,gBAAJ,CAAT;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASE,sBAAT,GAAkC;AAChCD,KAAGE,GAAH,0JACuCC,IADvC,CAC4C,UAASC,IAAT,EAAe;AACzD;AACA;AACA;AACA;AACA;AACA;;AAEA,QAAIC,WAAWC,gCAAgCF,IAAhC,CAAf;AACAG,YAAQC,GAAR,CAAY,aAAZ;AACAD,YAAQC,GAAR,CAAYC,KAAKC,SAAL,CAAeL,QAAf,EAAyB,IAAzB,EAA+B,CAA/B,CAAZ;AACD,GAZD,EAYGM,KAZH,CAYS,UAASC,GAAT,EAAc;AACrBL,YAAQM,KAAR,CAAcD,GAAd;AACD,GAdD;AAeD;;AAEDX;;AAEA,SAASK,+BAAT,CAAyCF,IAAzC,EAA+C;;AAE7C,MAAIU,mBAAmB,CAAC,CAAxB;AACA,MAAIV,KAAKW,MAAL,KAAgB,CAApB,EAAuB;AACrBD,uBAAmBV,KAAK,CAAL,EAAQY,UAA3B;AACD,GAFD,MAEO;AACL,WAAO,EAAP;AACD;;AAED,MAAIX,WAAW,EAAf;AACA,MAAIY,UAAUC,iBAAd;;AAEA,OAAK,IAAIC,CAAT,IAAcf,IAAd,EAAoB;AAClB,QAAIgB,UAAU,EAAd;AACA,QAAIN,qBAAqBV,KAAKe,CAAL,EAAQH,UAAjC,EAA6C;AAC3CC,cAAQD,UAAR,GAAqBZ,KAAKe,CAAL,EAAQH,UAA7B;AACAC,cAAQI,YAAR,GAAuBjB,KAAKe,CAAL,EAAQE,YAA/B;;AAEAD,gBAAU;AACRE,oBAAYlB,KAAKe,CAAL,EAAQG,UADZ;AAERC,sBAAcnB,KAAKe,CAAL,EAAQI;AAFd,OAAV;;AAKAN,cAAQO,QAAR,CAAiBC,IAAjB,CAAsBL,OAAtB;AACD,KAVD,MAUO;AACLf,eAASoB,IAAT,CAAcR,OAAd;;AAEAA,gBAAUC,iBAAV;;AAEAD,cAAQD,UAAR,GAAqBZ,KAAKe,CAAL,EAAQH,UAA7B;AACAC,cAAQI,YAAR,GAAuBjB,KAAKe,CAAL,EAAQE,YAA/B;;AAEAJ,cAAQO,QAAR,CAAiBT,MAAjB,GAA0B,CAA1B;AACAK,gBAAU;AACRE,oBAAYlB,KAAKe,CAAL,EAAQG,UADZ;AAERC,sBAAcnB,KAAKe,CAAL,EAAQI;AAFd,OAAV;AAIAN,cAAQO,QAAR,CAAiBC,IAAjB,CAAsBL,OAAtB;AACAN,yBAAmBV,KAAKe,CAAL,EAAQH,UAA3B;AACD;AAEF;AACDX,WAASoB,IAAT,CAAcR,OAAd;AACA;AACA,SAAOZ,QAAP;AACD;;AAGD,SAASa,eAAT,GAA2B;AACzB,SAAO;AACLF,gBAAY,CAAC,CADR;AAELK,kBAAc,EAFT;AAGLG,cAAU;AAHL,GAAP;AAKD;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"bd.js","sourcesContent":["'use strict';\n\nconst promise = require('bluebird');\n\nconst options = {\n  // Initialization Options\n  promiseLib: promise,\n};\n\nlet pgp = require('pg-promise')(options);\nlet connectionString = 'postgres://localhost:5432/testing';\nlet db = pgp(connectionString);\n\n// function getSubjectLectures() {\n//   db.any(`SELECT question_text, a2.answer_text correct_Answer, a.answer_text answer FROM questions q\n// JOIN questions_answers qa ON q.id = qa.questionid\n// JOIN answers a ON a.id = qa.answerid\n// JOIN answers a2 on q.answerid = a2.id;`)\n//   .then(function(data) {\n//     // res.status(200).json({\n//     //   status: 'success',\n//     //   data: data,\n//     //   message: 'Retrieved ALL puppies',\n//     // });\n//     console.log(JSON.stringify(data, null, 2));\n//\n//     let subjects = {}\n//\n//\n//   }).catch(function(err) {\n//     console.error(err);\n//   });\n// }\n//\n// getSubjectLectures();\n\nfunction getSubjectsAndLectures() {\n  db.any(`SELECT s.id as subject_id, s.name as Subject_Name, l.id as lecture_id, l.name as Lecture_Name FROM subjects s\nJOIN lectures l ON s.id = l.subjectid;`).then(function(data) {\n    // res.status(200).json({\n    //   status: 'success',\n    //   data: data,\n    //   message: 'Retrieved ALL puppies',\n    // });\n    // console.log(JSON.stringify(data, null, 2));\n\n    let subjects = makeTreeViewSubjectsAndLectures(data);\n    console.log('aaaaaaaaaad');\n    console.log(JSON.stringify(subjects, null, 2));\n  }).catch(function(err) {\n    console.error(err);\n  });\n}\n\ngetSubjectsAndLectures();\n\nfunction makeTreeViewSubjectsAndLectures(data) {\n\n  let currentSubjectId = -1;\n  if (data.length !== 0) {\n    currentSubjectId = data[0].subject_id;\n  } else {\n    return [];\n  }\n\n  let subjects = [];\n  let subject = getEmptySubject();\n\n  for (let i in data) {\n    let lecture = {};\n    if (currentSubjectId === data[i].subject_id) {\n      subject.subject_id = data[i].subject_id;\n      subject.subject_name = data[i].subject_name;\n\n      lecture = {\n        lecture_id: data[i].lecture_id,\n        lecture_name: data[i].lecture_name\n      };\n\n      subject.lectures.push(lecture);\n    } else {\n      subjects.push(subject);\n\n      subject = getEmptySubject();\n\n      subject.subject_id = data[i].subject_id;\n      subject.subject_name = data[i].subject_name;\n\n      subject.lectures.length = 0;\n      lecture = {\n        lecture_id: data[i].lecture_id,\n        lecture_name: data[i].lecture_name\n      };\n      subject.lectures.push(lecture);\n      currentSubjectId = data[i].subject_id;\n    }\n\n  }\n  subjects.push(subject);\n  // console.log(JSON.stringify(subjects, null, 2));\n  return subjects;\n}\n\n\nfunction getEmptySubject() {\n  return {\n    subject_id: -1,\n    subject_name: '',\n    lectures: []\n  };\n}\n\n// const pg = require('pg');\n// const connectionString = process.env.DATABASE_URL ||\n//     'postgres://localhost:5432/testing';\n//\n// const client = new pg.Client(connectionString);\n// client.connect();\n// let query = client.query(`INSERT INTO \\\"user\\\" VALUES (DEFAULT, 'Фомичев Егор Андреевич', 'ИУ1-123');`);\n// query.on('end', () => {\n//     client.end();\n// });\n\n"]}